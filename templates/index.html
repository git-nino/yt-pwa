<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YT Neon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="manifest" href="/static/app1/manifest.json">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-purple: #7000ff;
            --bg-dark: #0a0a0c;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 450px;
        }

        h1 {
            text-align: center;
            font-weight: 300;
            letter-spacing: 2px;
            text-shadow: 0 0 15px var(--neon-blue);
            margin-bottom: 40px;
        }

        #url {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: 1px solid #333;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            box-sizing: border-box;
            font-size: 16px;
            margin-bottom: 30px;
            outline: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* 2-Column Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        /* Bigger, professional buttons */
        .circle-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            font-weight: bold;
            font-size: 18px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s, box-shadow 0.3s;
            text-transform: uppercase;
        }

        .circle-btn:active { transform: scale(0.9); }

        .mp3-btn {
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            box-shadow: 0 0 20px rgba(0, 198, 255, 0.4);
        }

        .mp4-btn {
            background: linear-gradient(135deg, #9d50bb, #6e48aa);
            box-shadow: 0 0 20px rgba(157, 80, 187, 0.4);
        }

        select {
            width: 100%;
            background: #1a1a1d;
            color: #fff;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
        }

        progress {
            width: 100%;
            height: 10px;
            border-radius: 10px;
            appearance: none;
        }

        progress::-webkit-progress-bar { background-color: #222; border-radius: 10px; }
        progress::-webkit-progress-value { background: var(--neon-blue); border-radius: 10px; box-shadow: 0 0 10px var(--neon-blue); }

        #log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 12px;
            font-size: 12px;
            width: 100%;
            height: 120px;
            overflow-y: auto;
            margin-top: 25px;
            box-sizing: border-box;
            border: 1px solid #222;
            font-family: 'Courier New', monospace;
        }

        /* Information Card */
        .info-card {
            background: rgba(255, 255, 255, 0.07);
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
            border-left: 5px solid var(--neon-blue);
            animation: fadeIn 0.5s ease-in;
        }

        .info-card p { margin: 8px 0; font-size: 14px; word-break: break-all; }
        .info-card strong { color: var(--neon-blue); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h1>‚ö° YT NEON</h1>

    <input id="url" type="text" placeholder="Paste link here..." autocomplete="off">

    <div class="controls-grid">
        <div class="control-group">
            <button class="circle-btn mp3-btn" onclick="startDownload('mp3')">MP3</button>
            <select id="quality-mp3">
                <option value="0">Best Audio</option>
                <option value="5">Standard</option>
            </select>
        </div>

        <div class="control-group">
            <button class="circle-btn mp4-btn" onclick="startDownload('mp4')">MP4</button>
            <select id="quality-mp4">
                <option value="best">Best Video</option>
                <option value="best[height<=720]">720p</option>
                <option value="best[height<=480]">480p</option>
            </select>
        </div>
    </div>

    <progress id="bar" value="0" max="100"></progress>

    <div id="fileInfo" class="info-card" hidden>
        <p><strong>‚úÖ Saved:</strong> <span id="fileName"></span></p>
        <p><strong>üìç Path:</strong> <span id="filePath"></span></p>
    </div>

    <pre id="log">Ready...</pre>
</div>

<script>
    function startDownload(mode) {
        const urlInput = document.getElementById('url');
        const quality = document.getElementById(`quality-${mode}`).value;
        const log = document.getElementById('log');
        const bar = document.getElementById('bar');
        const info = document.getElementById('fileInfo');
        
        if(!urlInput.value) {
            alert("Please paste a URL");
            return;
        }

        // Reset UI
        info.hidden = true;
        bar.value = 0;
        log.textContent = `Initializing ${mode.toUpperCase()} download...`;

        const eventSource = new EventSource(`/download/${mode}?url=${encodeURIComponent(urlInput.value)}&quality=${quality}`);

        eventSource.onmessage = function(e) {
            if (e.data === "__DONE__") {
                eventSource.close();
                log.textContent += "\n[System] Download Complete.";
                bar.value = 100;
                
                // Show file info 
                document.getElementById('fileName').textContent = "Media_" + new Date().getTime() + "." + mode;
                document.getElementById('filePath').textContent = "/storage/downloads/" + mode + "/";
                info.hidden = false;
            } else {
                log.textContent += "\n" + e.data;
                log.scrollTop = log.scrollHeight;
                
                const match = e.data.match(/(\d+\.\d+)%/);
                if (match) bar.value = parseFloat(match[1]);
            }
        };

        eventSource.onerror = function() {
            eventSource.close();
            log.textContent += "\n[Error] Connection lost or script failed.";
        };
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/app1/sw.js', { scope: '/app1/' });
      });
    }
</script>

</body>
</html>
